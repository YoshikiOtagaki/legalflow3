
### Cursorへの指示プロンプト

あなたは、この弁護士向け事件管理WebサービスのバックエンドAPIを開発した担当者です。現在、テスト駆動開発（TDD）のフェーズ3.2（テスト先行開発）を完了し、次の実装フェーズに移る手前の段階です。

しかし、あなたが作成した**T029: `/cases` APIエンドポイントの契約テスト** (`cases.test.ts`) が失敗しており、実装に進むことができません。

あなたのタスクは、このテストの失敗原因を特定し、修正することです。

以下の手順に従って、デバッグ作業を進めてください。

**ステップ1：プロジェクトの全体像と仕様の理解**

まず、以下のファイルをすべて読み込み、プロジェクトの目的、仕様、現在のコード構成を完全に理解してください。

*   `specs/001-web/tasks.md`: プロジェクト全体のタスクリストと進捗状況。
*   `.gemini/commands/plan.toml`: アプリケーションの全体計画。
*   `.gemini/commands/specify.toml`: アプリケーションのコア仕様と要件。
*   `backend/api_service/prisma/schema.prisma`: データベースのモデル定義。テスト対象のAPIが扱うデータ構造を理解するために不可欠です。
*   `backend/api_service/package.json`: プロジェクトの依存関係とスクリプト（特にテストの実行方法）。
*   `backend/api_service/jest.config.js`: Jestのテスト設定。
*   `backend/api_service/tests/setup.ts`: グローバルなテストセットアップ。
*   `backend/api_service/tests/api-test-setup.ts`: APIテスト固有のセットアップ（`supertest`エージェントの初期化など）。

**ステップ2：失敗しているテストの特定と分析**

次に、問題のテストファイル `backend/api_service/tests/api/cases.test.ts` の内容を精査します。

1.  `npm test` コマンド（または `jest`）を `backend/api_service` ディレクトリで実行し、`cases.test.ts` が出力する具体的なエラーメッセージを正確に把握してください。
2.  エラーメッセージとスタックトレースを分析し、どのテストケース（`describe` や `it` ブロック）で、どのような問題（例: `404 Not Found` を期待しているが `500 Internal Server Error` が返ってくる、レスポンスボディのアサーションが一致しない、など）が発生しているかを特定します。

**ステップ3：原因の調査とコードレビュー**

特定したエラーと `specify.toml` の仕様を基に、`cases.test.ts` のコードを詳細にレビューしてください。特に以下の点に注意して問題の根本原因を探ります。

*   **テストロジックの誤り**: アサーション（`expect`）の内容は仕様と一致していますか？
*   **セットアップの問題**: テスト実行前のデータ作成（例: `prisma.caseCategory.create`）は正しく行われていますか？ テスト間でデータがクリーンアップされていますか？
*   **APIリクエストの誤り**: `supertest` (`agent`) を使ったリクエスト（URL、HTTPメソッド、ペイロード）は正しいですか？
*   **スキーマとの不整合**: `schema.prisma` で定義されたモデルと、テストコードで作成・期待しているデータの構造は一致していますか？
*   **単純な構文エラーやタイプミス**。

**ステップ4：修正案の提示**

根本原因を特定したら、問題を明確に説明し、`backend/api_service/tests/api/cases.test.ts` の修正版コードを提示してください。

**ステップ5：修正の検証**

修正を適用した後、再度テストを実行し、すべてのテストがパスすることを確認する手順を説明してください。

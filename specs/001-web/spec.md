# Feature Specification: 弁護士向け案件管理Webサービス (v2.2)

**Feature Branch**: `001-web`
**Status**: Finalized

---

## 1. User Scenarios & Testing

### Primary User Stories
1. **事件中心の管理**: 弁護士は、多種多様な「事件」の情報を、その類型に応じて最適化された形で、一元的に登録・管理したい。
2. **チーム連携**: 弁護士は、同僚の弁護士やパラリーガルと特定の事件情報を共有し、共同で作業を進めたい。
3. **ワークフローの自動化**: 弁護士は、事件が特定の段階（フェーズ）に進んだ際に、必要なタスクリストが自動的に生成されることで、作業の標準化と抜け漏れ防止を実現したい。
4. **リアルタイム通知**: 弁護士は、担当事件に重要な更新があった際に、LINEなどでタイムリーな通知を受け取り、迅速に情報を把握したい。
5. **簡単なタイムチャージ**: 弁護士は、アプリのどこからでもワンクリックで作業時間を記録開始でき、手間なく正しい事件に紐付けたい。
6. **文書作成の自動化**: 弁護士は、事件情報や手元資料から、書式やレイアウトが整った定型的な法律文書を半自動で生成し、作成業務を劇的に効率化したい。

### Acceptance Scenarios
- **Given** ある弁護士が事件の共同担当者として別の弁護士を追加する, **When** 追加された弁護士がログインする, **Then** その事件が自分の事件一覧に表示され、編集が可能になる。
- **Given** ある弁護士が自身のパラリーガルアカウントを紐付ける, **When** そのパラリーガルがログインする, **Then** 弁護士が許可した範囲の事件データにアクセスできる。
- **Given** 無料プランのユーザーが5件の事件を登録している, **When** 6件目の事件を登録しようとする, **Then** 上位プランへのアップグレードを促すメッセージが表示される。

---

## 2. Requirements

### FR-A: Core & Platform
- **FR-A01**: **ユーザー管理と役割**: システムは、複数のユーザー役割（ロール）をサポートすること。初期ロールとして以下を定義する。
    - **弁護士**: 全機能にアクセス可能。
    - **パラリーガル**: 紐づけられた弁護士のデータにのみ、制限されたアクセス権を持つ。
- **FR-A02**: **課金管理とプラン**: システムは、複数のサブスクリプションプランを管理できること。初期プランとして以下を定義する。
    - **無料プラン**: 事件登録数5件まで。
    - **弁護士プラン**: 無制限。
    - **パラリーガルプラン**: 弁護士プランより安価な価格設定。

### FR-B: Case Management & Workflow
- **FR-B01**: **事件カテゴリ**: 「事件」は階層的なカテゴリによって管理されること。
- **FR-B02**: **コラボレーション**: １つの事件に複数の弁護士を「担当者」として割り当て、共同編集を可能にすること。
- **FR-B03**: **フェーズ管理とタスク自動生成**: 事件カテゴリごとに定義された「フェーズ」を移行することで、関連するタスクリストが自動生成されること。

(他要件は変更なし)

---

## 3. Key Entities & Data Structure

- **User**: `Role` (`Lawyer`, `Paralegal`) 属性を持つ。
- **Case**: 事件の本体。
- **CaseAssignment**: 事件とユーザーの関連付け。`CaseID`, `UserID`, `CaseRole` (例: `Lead`, `Collaborator`) を持つ。
- **Subscription**: ユーザーの課金情報。`PlanType` (`Free`, `Lawyer`, `Paralegal`) と現在の事件数 `CaseCount` を持つ。
- (その他、既存エンティティは変更なし)

---

## 4. Non-Functional Requirements & Technical Constraints

- **NFR-001**: **Frontend**: React, Next.js, Tailwind CSS
- **NFR-002**: **UI**: 日本語、レスポンシブデザイン
- **NFR-003**: **Backend/Infra**: AWSサービスで統一。セキュリティと個人情報保護を最優先し、可能な限り日本リージョンを利用する。
- **NFR-004**: **Performance**: ページ読み込み時間2秒以内を目標とする。
- **NFR-005**: **Scale**: 初期ユーザー500人、アクティブな事件5万件規模を問題なく処理できること。
- **NFR-006**: **Integrations**: Google Calendar, Microsoft Outlook Calendar, LINE Messaging API
